# PRD 03: Stacking/Tower Builder - "Stack 'Em High: DMI Core Tower"

## Reference Games

### Stack
- **Screenshot:** https://play-lh.googleusercontent.com/5Qp_LKvYqHDQwvPj8mN8XxQNkLqHJW4vQ2J4Y0J4Y0J4Y0J4Y0J4Y0J4Y0J4Y0J4Y0=w2560-h1440
- **Developer:** Ketchapp
- **Core Mechanic:** Tap to drop moving block onto stack, perfectly aligned blocks keep full size, misaligned blocks get trimmed

### Tower Bloxx
- **Screenshot:** https://play-lh.googleusercontent.com/8fH9K3Zx9Z8K3Zx9Z8K3Zx9Z8K3Zx9Z8K3Zx9Z8K3Zx9Z8K3Zx9Z8K3Zx9Z8K3Zx=w2560-h1440
- **Developer:** Digital Chocolate
- **Core Mechanic:** Tap to release swinging block, stack apartments to build skyscraper, precision = bonus

### 99 Bricks Wizard Academy
- **Screenshot:** https://play-lh.googleusercontent.com/Bricks_Wizard_Screenshot
- **Developer:** WeirdBeard
- **Core Mechanic:** Tetris-style block stacking with physics, balance matters, create stable tower

## Core Mechanics

### Primary Action
- **Block Movement:** Rectangular block slides horizontally back and forth across screen
- **Drop Timing:** Tap/click to drop block onto stack
- **Alignment:**
  - **Perfect Drop:** Block lands exactly aligned with previous block → Full size maintained + bonus points
  - **Good Drop:** Partial overlap → Overhanging portion is trimmed off, remaining part continues
  - **Miss:** No overlap → Game over (block falls off tower)

### Win/Fail Conditions
- **Win State:** Endless mode - no traditional win, only high score pursuit
- **Challenges:** Complete X floors in time limit, reach specific height milestones
- **Fail State:** 
  - Block misses stack entirely (no overlap)
  - Tower becomes too narrow to continue (<10% of original width)
  - In timed challenges: fail to reach goal before time expires

### Progression System
- **Height Score:** Primary metric (number of blocks successfully stacked)
- **Precision Bonuses:** Perfect drops earn 2x points, consecutive perfects create combo multipliers
- **Unlock System:** Reach height milestones to unlock new block skins, tower themes, and backgrounds
- **Daily Challenges:** "Stack 50 blocks with 70% perfect rate" for coin rewards
- **Leaderboards:** Global and friends rankings for bragging rights

## DMI Theme Concept

### Title: **"Stack 'Em High: DMI Core Tower"**

### Tagline
*"Precision drilling starts with precision stacking. How high can you build?"*

### Player Role
**Warehouse Foreman** at DMI's distribution center. Your job is to stack incoming shipments of diamond core barrels onto delivery pallets for transport to job sites. Every stack must be perfect—wobbly towers waste time, money, and can damage premium diamond equipment.

### Story Hook
DMI's busiest distribution hub just received a massive shipment of diamond core barrels from the factory. As the warehouse foreman, you need to organize and stack these barrels on pallets for outbound delivery. The higher you stack (safely), the more efficient the shipping operation. But one wrong move and the whole tower tumbles—costing DMI money and delaying critical job site deliveries. Stack with precision, earn your bonus, and become the legendary "Stack Master" of DMI Tools Corp!

### Block Types (Unlockable Skins)

#### Standard Blocks (always available)
1. **Concrete Core Barrels** - Gray cylindrical drums with DMI logo
2. **Asphalt Core Boxes** - Black rectangular crates
3. **Masonry Bit Pallets** - Brown wooden pallets stacked with bits

#### Unlockable Premium Blocks (earn via milestones)
4. **Diamond Blade Crates** (25 blocks) - Metallic silver cases with caution labels
5. **Pink Diamond Boxes** (50 blocks) - Premium pink packaging for specialty blades
6. **Turbo Segment Tubes** (75 blocks) - Blue cylindrical tubes with turbocharged design
7. **Gold Standard Barrels** (100 blocks) - Gold-tinted premium core barrels
8. **Rainbow Core Collection** (150 blocks) - Multi-color variety pack crates
9. **Crystal Diamond Containers** (200 blocks) - Transparent cases showing diamonds inside

Each skin is purely cosmetic but provides psychological reward for reaching milestones.

### Environmental Themes (Unlockable Backgrounds)

1. **Warehouse Floor** (default) - Gray concrete floor, forklift in background
2. **Loading Dock** (10 blocks) - Outdoor dock with trucks, sunshine
3. **Factory Floor** (25 blocks) - Industrial machinery, assembly lines
4. **Job Site** (50 blocks) - Construction site with cranes, scaffolding
5. **Skyscraper Rooftop** (100 blocks) - City skyline below, clouds above
6. **Diamond Mine** (150 blocks) - Underground cavern with crystal formations
7. **Space Station** (200 blocks) - Zero-gravity industrial platform (whimsical!)

### Visual Elements

#### The Stack Platform
- **Base:** Heavy-duty DMI-branded blue pallet (stationary)
- **Drop Zone:** Platform has alignment markers (center line, edge indicators)
- **Shadow:** Moving block casts shadow on stack below to aid depth perception

#### The Moving Block
- **Animation:** Slides smoothly back and forth (speed increases with height)
- **Visual Feedback:**
  - Green glow when directly over previous block (perfect alignment zone)
  - Yellow glow for partial overlap (okay alignment)
  - Red flash if going to miss entirely
- **Physics:** Overhanging portion wobbles slightly before dropping off

#### Scoring & Feedback
- **Perfect Drop:** 
  - Screen flash (white)
  - "PERFECT!" text in DMI blue
  - +100 points + combo multiplier
  - Confetti particles burst
  
- **Good Drop:**
  - Trimming animation (saw blade slices overhanging part)
  - Metal sparks particle effect
  - +50 points
  
- **Combo System:**
  - 3 perfects in a row: "COMBO x2!"
  - 5 perfects: "AMAZING x3!"
  - 10 perfects: "LEGENDARY x5!"
  - Combo breaks on non-perfect drop

### Power-Ups (Optional Assist Items)

#### Slow Motion (earned every 10 blocks)
- **Effect:** Block movement slows to 50% for 5 seconds
- **Visual:** Blue time-distortion effect, clock icon
- **Use Case:** Helpful when speed increases at higher levels

#### Guideline (earned every 15 blocks)
- **Effect:** Vertical laser line shows perfect drop point for 3 drops
- **Visual:** Red laser beam from top to bottom
- **Use Case:** Precision assistance for tricky drops

#### Stabilizer (earned every 20 blocks)
- **Effect:** Next 3 drops automatically center themselves (auto-perfect)
- **Visual:** Golden stabilizer arms extend from base
- **Use Case:** Safety net for high-pressure moments

#### Magnet Mode (earned every 25 blocks)
- **Effect:** Next 5 drops have "snap to center" within 80% alignment
- **Visual:** Electromagnetic field around platform
- **Use Case:** Forgiveness for near-misses

### Collectibles (Optional Layer)

#### DMI Coins (bonus items)
- **Appearance:** Occasionally float by during block movement
- **Collection:** Tap coin while block is moving (risky!)
- **Value:** 10 coins = 1 power-up purchase
- **Risk/Reward:** Tapping coin might cause you to miss drop timing

#### Achievement Badges
- "First Tower" - Stack 10 blocks
- "Warehouse Pro" - Stack 25 blocks
- "Perfect Precision" - 10 perfect drops in a row
- "Sky High" - Reach 50 blocks
- "Combo King" - Achieve x5 multiplier
- "Diamond Standard" - Stack 100 blocks
- "Legendary Foreman" - Stack 200 blocks

## Visual Style Recommendations

### Art Direction
- **Style:** Clean, minimalist 3D with realistic materials
- **Palette:**
  - Primary: DMI Blue (#003DA5), Industrial Gray (#4A4A4A)
  - Accents: Safety Yellow (#FFD700), Warning Orange (#FF6B35)
  - Backgrounds: Atmospheric gradients (sky blue to horizon, cave darkness to glow)
- **Lighting:** Overhead warehouse lights, cast shadows for depth

### Block Design
- **Materials:** Photorealistic textures (wood grain, metal, cardboard)
- **Branding:** DMI logo visible on each block face
- **Details:** Shipping labels, barcodes, caution stickers
- **Weathering:** Subtle wear and tear for authenticity

### Camera & Perspective
- **View:** Isometric 3D perspective (slight angle for depth)
- **Zoom:** Camera slowly zooms out as tower grows taller
- **Tracking:** Camera follows tower upward, keeps top 3-4 blocks visible
- **Framing:** Always show base platform at bottom for reference

### Animation Details
- **Block Movement:** Smooth linear interpolation, easing at direction changes
- **Drop Animation:** 
  - Quick descent (0.3s)
  - Slight bounce on landing (realistic physics)
  - Settling animation (0.1s)
- **Trim Animation:**
  - Overhanging section glows red
  - Saw blade slices through (0.2s)
  - Cut piece falls off screen with rotation
- **Tower Collapse:** 
  - If blocks wobble too much, tower tilts and collapses
  - Blocks tumble down with realistic physics
  - Slow-motion effect on final moments

### UI Elements
- **Top Bar:**
  - Current height (block count)
  - High score
  - Combo multiplier indicator
- **Bottom Bar:**
  - Power-up inventory (icons with quantity)
  - Pause button
- **Center Screen:**
  - Feedback text ("PERFECT!", "GOOD!", "COMBO x3!")
  - Score popups (+100, +50)

## Technical Specifications (Phaser 3)

### Scene Architecture
```javascript
class StackingGameScene extends Phaser.Scene {
  create() {
    this.stack = []; // Array of placed blocks
    this.currentBlock = null;
    this.blockSpeed = 200; // pixels per second
    this.direction = 1; // 1 = right, -1 = left
    this.baseWidth = 200; // Starting block width
    this.score = 0;
    this.perfectStreak = 0;
    
    this.createBase();
    this.spawnNewBlock();
    this.setupInput();
  }
  
  update(time, delta) {
    if (this.currentBlock) {
      this.moveBlock(delta);
      this.checkAlignment(); // Visual feedback
    }
  }
}
```

### Key Systems

#### 1. Block Movement System
```javascript
moveBlock(delta) {
  const speed = this.blockSpeed + (this.stack.length * 10); // Speed increases
  this.currentBlock.x += this.direction * speed * (delta / 1000);
  
  // Reverse direction at screen edges
  const leftBound = this.cameras.main.width * 0.2;
  const rightBound = this.cameras.main.width * 0.8;
  
  if (this.currentBlock.x >= rightBound) {
    this.direction = -1;
  } else if (this.currentBlock.x <= leftBound) {
    this.direction = 1;
  }
}
```

#### 2. Drop & Alignment Detection
```javascript
dropBlock() {
  if (!this.currentBlock) return;
  
  const droppedBlock = this.currentBlock;
  const previousBlock = this.stack[this.stack.length - 1] || this.basePlatform;
  
  // Calculate overlap
  const overlap = this.calculateOverlap(droppedBlock, previousBlock);
  
  if (overlap.percentage === 100) {
    // Perfect drop
    this.handlePerfectDrop(droppedBlock);
  } else if (overlap.percentage > 0) {
    // Partial overlap - trim
    this.handlePartialDrop(droppedBlock, overlap);
  } else {
    // Complete miss - game over
    this.handleMiss(droppedBlock);
  }
}

calculateOverlap(block1, block2) {
  const left1 = block1.x - block1.width / 2;
  const right1 = block1.x + block1.width / 2;
  const left2 = block2.x - block2.width / 2;
  const right2 = block2.x + block2.width / 2;
  
  const overlapLeft = Math.max(left1, left2);
  const overlapRight = Math.min(right1, right2);
  const overlapWidth = Math.max(0, overlapRight - overlapLeft);
  
  return {
    width: overlapWidth,
    percentage: (overlapWidth / block1.width) * 100,
    center: (overlapLeft + overlapRight) / 2
  };
}
```

#### 3. Perfect Drop Logic
```javascript
handlePerfectDrop(block) {
  // Stop block movement
  block.body.setVelocity(0, 0);
  
  // Position exactly on previous block
  const previousBlock = this.stack[this.stack.length - 1];
  block.x = previousBlock.x;
  block.width = previousBlock.width; // Keep full size
  
  // Visual feedback
  this.showPerfectEffect(block);
  this.playSound('perfect');
  
  // Scoring
  this.perfectStreak++;
  const comboMultiplier = Math.min(this.perfectStreak, 5);
  const points = 100 * comboMultiplier;
  this.addScore(points);
  this.showScoreText('+' + points, block.x, block.y);
  
  if (this.perfectStreak >= 3) {
    this.showComboText('x' + comboMultiplier);
  }
  
  // Add to stack
  this.stack.push(block);
  
  // Spawn next block
  this.time.delayedCall(500, () => this.spawnNewBlock());
}

showPerfectEffect(block) {
  // Screen flash
  this.cameras.main.flash(200, 255, 255, 255, true);
  
  // Confetti particles
  this.add.particles(block.x, block.y, 'diamond-sparkle', {
    speed: { min: 100, max: 200 },
    angle: { min: 0, max: 360 },
    scale: { start: 0.5, end: 0 },
    lifespan: 800,
    quantity: 20
  });
  
  // "PERFECT!" text
  const text = this.add.text(block.x, block.y - 50, 'PERFECT!', {
    fontSize: '48px',
    fontFamily: 'Arial',
    color: '#003DA5',
    fontStyle: 'bold'
  }).setOrigin(0.5);
  
  this.tweens.add({
    targets: text,
    y: block.y - 100,
    alpha: 0,
    duration: 1000,
    ease: 'Cubic.easeOut',
    onComplete: () => text.destroy()
  });
}
```

#### 4. Partial Drop & Trimming
```javascript
handlePartialDrop(block, overlap) {
  // Reset streak
  this.perfectStreak = 0;
  
  // Trim block to overlap size
  const previousBlock = this.stack[this.stack.length - 1];
  const newWidth = overlap.width;
  const cutPortion = block.width - newWidth;
  
  // Determine which side to cut
  const blockCenter = block.x;
  const overlapCenter = overlap.center;
  const overhangDirection = blockCenter > overlapCenter ? 1 : -1;
  
  // Animate trim
  this.animateTrim(block, cutPortion, overhangDirection);
  
  // Update block properties
  block.width = newWidth;
  block.x = overlapCenter;
  
  // Scoring
  const points = 50;
  this.addScore(points);
  this.showScoreText('+' + points, block.x, block.y);
  
  // Check if block is too narrow
  if (newWidth < this.baseWidth * 0.1) {
    this.gameOver('Tower too narrow!');
    return;
  }
  
  // Add to stack
  this.stack.push(block);
  
  // Spawn next block
  this.time.delayedCall(500, () => this.spawnNewBlock());
}

animateTrim(block, cutWidth, direction) {
  // Create visual for cut portion
  const cutPiece = this.add.rectangle(
    block.x + (direction * cutWidth / 2),
    block.y,
    cutWidth,
    block.height,
    0xff0000,
    0.7
  );
  
  // Saw blade effect
  const saw = this.add.sprite(block.x, block.y, 'saw-blade');
  saw.play('saw-spin');
  this.playSound('saw-cutting');
  
  // Particle sparks
  this.add.particles(block.x, block.y, 'spark', {
    speed: { min: 50, max: 150 },
    angle: { min: -45, max: 45 },
    lifespan: 500,
    quantity: 15
  });
  
  // Animate cut piece falling
  this.tweens.add({
    targets: cutPiece,
    y: this.cameras.main.height + 100,
    angle: direction * 360,
    alpha: 0,
    duration: 1000,
    ease: 'Cubic.easeIn',
    onComplete: () => {
      cutPiece.destroy();
      saw.destroy();
    }
  });
}
```

#### 5. Camera Tracking
```javascript
updateCamera() {
  if (this.stack.length === 0) return;
  
  const topBlock = this.stack[this.stack.length - 1];
  const targetY = topBlock.y - 300; // Keep top of tower in upper portion of screen
  
  this.cameras.main.scrollY = Phaser.Math.Linear(
    this.cameras.main.scrollY,
    targetY,
    0.1
  );
  
  // Zoom out as tower grows
  const heightRatio = this.stack.length / 100;
  const targetZoom = Math.max(0.5, 1 - heightRatio * 0.3);
  this.cameras.main.zoom = Phaser.Math.Linear(
    this.cameras.main.zoom,
    targetZoom,
    0.05
  );
}
```

#### 6. Power-Up System
```javascript
class PowerUpManager {
  activateSlowMotion() {
    this.scene.time.timeScale = 0.5; // Slow game time
    this.scene.add.text(400, 100, 'SLOW MOTION', { fontSize: '32px', color: '#00D9FF' });
    
    this.scene.time.delayedCall(5000, () => {
      this.scene.time.timeScale = 1.0;
    });
  }
  
  activateGuideline() {
    const previousBlock = this.scene.stack[this.scene.stack.length - 1];
    const guideline = this.scene.add.line(
      0, 0,
      previousBlock.x, 0,
      previousBlock.x, this.scene.cameras.main.height,
      0xff0000,
      0.5
    );
    
    this.guidelineDropsRemaining = 3;
    
    // Remove guideline after 3 drops
    this.scene.events.on('blockDropped', () => {
      this.guidelineDropsRemaining--;
      if (this.guidelineDropsRemaining <= 0) {
        guideline.destroy();
      }
    });
  }
  
  activateStabilizer() {
    this.stabilizedDropsRemaining = 3;
    
    // Auto-perfect next 3 drops
    this.scene.events.on('blockDropped', (block) => {
      if (this.stabilizedDropsRemaining > 0) {
        // Force perfect alignment
        const previousBlock = this.scene.stack[this.scene.stack.length - 1];
        block.x = previousBlock.x;
        this.stabilizedDropsRemaining--;
      }
    });
  }
}
```

### Asset Requirements

#### 3D Models / Sprites
- **Blocks:** Pre-rendered 3D sprites of barrels, crates, boxes (9 skin variants)
- **Base Platform:** Heavy-duty DMI pallet (blue, weathered wood texture)
- **Saw Blade:** Spinning diamond blade animation (8 frames)
- **Background Elements:** Warehouse interior, forklifts, cranes, skylines

#### Particles
- **Confetti:** Colorful paper pieces for perfect drops
- **Sparks:** Orange/yellow welding sparks for trimming
- **Diamond Sparkle:** Blue shimmer for premium blocks
- **Dust Cloud:** Gray puff on block landing

#### UI Graphics
- **Icons:** Power-ups (slow-mo clock, guideline laser, stabilizer, magnet)
- **Buttons:** Play, pause, restart, settings
- **Badges:** Achievement icons
- **Text:** Score counter, combo multiplier, feedback messages

#### Audio
- **SFX:**
  - Block landing (thud) - pitch varies by block size
  - Perfect drop (chime, bells)
  - Saw cutting (metallic grinding)
  - Block falling (descending whistle)
  - Combo achieved (ascending arpeggio)
  - Game over (crash, glass breaking)
  - Power-up activation (electric charge, laser, magnetic hum)
  
- **Music:**
  - Calm, focused background track (warehouse ambience with subtle beat)
  - Intensity increases with combo multiplier
  - Victory jingle for milestones

### Performance Optimization

- **Object Pooling:** Reuse block sprites, destroy blocks far below camera
- **Physics:** Use simple AABB collision, disable physics on settled blocks
- **Render Distance:** Only render blocks within camera view + 1 screen buffer
- **Particle Limits:** Max 100 particles on screen
- **Memory:** Destroy off-screen fallen blocks immediately

### Mobile Considerations
- **Touch Input:** Tap anywhere on screen to drop (large hitbox)
- **Visual Feedback:** Large, clear alignment indicators
- **Performance:** Target 60fps on mid-range devices
- **Portrait Mode:** Optimal for one-handed play
- **Haptics:** Vibration feedback on perfect drops and trims

## PRD Summary

**Stack 'Em High: DMI Core Tower** distills the hypnotic satisfaction of precision stacking games into a branded experience that reinforces DMI's core values of accuracy, quality, and expertise. Players become warehouse foremen tasked with stacking incoming shipments of diamond core barrels and tool crates onto delivery pallets—the higher the stack, the more efficient the operation. The core mechanic is instantly understandable: a block slides back and forth across the screen, tap to drop it onto the growing tower. Perfect alignment maintains full block size and awards combo multipliers; misalignment trims the overhanging portion in a satisfying saw-cutting animation complete with sparks and falling debris.

The game's minimalist design philosophy ensures nothing distracts from the core precision challenge. Clean 3D graphics showcase realistic DMI-branded equipment with weathered textures and authentic industrial details. As the tower grows, the camera gradually zooms out to reveal the full height of the player's accomplishment, creating a powerful sense of vertical progression. The unlockable block skins and environmental themes provide long-term goals—stack 50 blocks to unlock Pink Diamond Boxes, reach 100 for the city skyline background—while the streak-based combo system rewards sustained perfection with escalating score multipliers and dramatic visual effects.

From a technical perspective, this is one of the simplest game concepts to implement in Phaser 3, making it an ideal candidate for rapid development and deployment. The entire game logic revolves around block movement tweens, overlap detection math, and camera tracking—no complex systems or state machines required. The minimalist asset requirements (block sprites, a few particle effects, simple UI) keep file sizes tiny for instant loading. The addictive "one more try" loop makes it perfect for micro-sessions on mobile devices, while the precision-based scoring appeals to DMI's target audience of construction professionals who take pride in accuracy and craftsmanship. Optional power-ups (slow-motion, guidelines, stabilizers) provide assist for casual players without compromising the pure skill challenge for purists. This PRD positions Stack 'Em High as a quick-to-develop, high-replay-value entry in the DMI game portfolio, perfect for social media virality and brand awareness campaigns.
